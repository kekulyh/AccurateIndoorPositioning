!function(V,I){"use strict";var m="ht",O=m+".layout.",y=V[m]||module.parent.exports.ht,d=y.List,b=y.DataModel,C=y.Node,_=y.Edge,F=y.Group,N=Math,i=N.sqrt,E=N.random,l=N.max,k=N.min,Z=function(A){return A*A};y.Default.getInternal().addMSMap({ms_force:function(x){x._interval=50,x._stepCount=10,x._motionLimit=.01,x._edgeRepulsion=.65,x._nodeRepulsion=.65,x._damper=1,x._maxMotion=0,x._motionRatio=0,x.init=function(A){var z=this;A instanceof b?z.dm=A:z.gv=A,z._nodeMap={},z._nodes=new d,z._edges=new d},x.start=function(){var b=this,K=b.gv;if(!b._timer){var A=b.cdm=K?K.dm():b.dm;A.mm(b.handleDataModelChange,b),A.md(b.handleDataPropertyChange,b),K&&K.mp(b.handleGV,b),A.each(function(U){if(b.isVisible(U)&&b.isLayoutable(U)&&U instanceof C)if(b instanceof f){var x=U.p3();U.p3([x[0]+E(),x[1]+E(),x[2]+E()])}else x=U.p(),U.p(x.x+E(),x.y+E())}),b._timer=setInterval(function(){b.relax()},b._interval),b._damper=1}},x.stop=function(){var E=this;E._timer&&(E.cdm.umm(E.handleDataModelChange,E),E.cdm.umd(E.handleDataPropertyChange,E),E.gv&&E.gv.ump(E.handleGV,E),clearInterval(E._timer),delete E._timer,delete E.cdm)},x.handleGV=function(e){var f=this;if("dataModel"===e.property){var t=e.oldValue,M=e.newValue;t&&(t.umm(f.handleDataModelChange,f),t.umd(f.handleDataPropertyChange,f)),this.cdm=M,M.mm(f.handleDataModelChange,f),M.md(f.handleDataPropertyChange,f)}},x.relax=function(){var G=this;if(!(G._damper<.1&&G._maxMotion<G._motionLimit)){this.cdm.each(function(N){G.isVisible(N)&&(N instanceof _?G.addEdge(N):N instanceof C&&G.addNode(N))});for(var u,e,A=0,R=G._edges,v=G._nodes,n=v.size();A<G._stepCount;A++){for(R.each(G.relaxEdge,G),u=0;n>u;u++)for(e=0;n>e;e++)G.relaxNode(v.get(u),v.get(e));G.moveNode()}G._isAdjusting=1,v.each(function(L){L.fix||(L.p?L.v.p3(L.p):L.v.p(L.x,L.y))}),delete G._isAdjusting,G._nodeMap={},v.clear(),R.clear(),G.onRelaxed()}},x.onRelaxed=function(){},x.isRunning=function(){return!!this._timer},x.isVisible=function(h){return h.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(h):!0},x.isLayoutable=function(k){if(k.s("layoutable")===!1)return!1;if(k instanceof F)return!1;var L=this;return L.gv?L.gv.isMovable(k)&&!L.gv.isSelected(k):!(L.cdm||L.dm).sm().co(k)},x.getNodeRepulsion=function(){return this._nodeRepulsion},x.setNodeRepulsion=function(U){this._nodeRepulsion=U,this._damper=1},x.getEdgeRepulsion=function(){return this._edgeRepulsion},x.setEdgeRepulsion=function(d){this._edgeRepulsion=d,this._damper=1},x.getStepCount=function(){return this._stepCount},x.setStepCount=function(t){this._stepCount=t,this._damper=1},x.getInterval=function(){return this._interval},x.setInterval=function(t){var q=this;q._interval!==t&&(q._interval=t,q._timer&&(clearInterval(q._timer),q._timer=setInterval(function(){q.relax()},t)))},x.handleDataPropertyChange=function(f){!this._isAdjusting&&this.isVisible(f.data)&&(this._damper=1)},x.handleDataModelChange=function(){this._damper=1},x.damp=function(){var E=this._maxMotion,_=this._damper;this._motionRatio<=.001&&((.2>E||E>1&&.9>_)&&_>.01?this._damper-=.01:.4>E&&_>.003?this._damper-=.003:_>1e-4&&(this._damper-=1e-4)),E<this._motionLimit&&(this._damper=0)}}}),y.layout.ForceLayout=function(v){this.init(v)},y.Default.def(O+"ForceLayout",I,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function($){this._limitBounds=$,this._damper=1},getNodeSize:function(Y){var i=this.gv;return i&&i.getDataUIBounds?i.getDataUIBounds(Y):Y.getRect()},addNode:function(K){var o=this,m=o._nodeMap[K._id];if(m)return m;var Y=K.p();m={v:K,x:Y.x,y:Y.y,dx:0,dy:0,fix:!o.isLayoutable(K),s:o.getNodeSize(K)};var n=m.s,r=i(Z(n.width)+Z(n.height))*o._nodeRepulsion;return m.r=1>r?100:r,o._nodeMap[K._id]=m,o._nodes.add(m),m},addEdge:function(m){if(m._40I&&m._41I){var Y=this,o=Y.addNode(m._40I),t=Y.addNode(m._41I),$={s:o,t:t};t=t.s,o=o.s;var w=t.width+o.width,F=t.height+o.height;$.length=i(w*w+F*F)*Y._edgeRepulsion,$.length<=0&&($.length=100),Y._edges.add($)}},relaxEdge:function(G){var T=G.t,M=G.s,Z=T.x-M.x,K=T.y-M.y,C=i(Z*Z+K*K),d=100*G.length,F=.25*Z/d*C,e=.25*K/d*C;T.dx=T.dx-F,T.dy=T.dy-e,M.dx=M.dx+F,M.dy=M.dy+e},relaxNode:function(b,M){if(b!==M){var U=0,s=0,p=b.x-M.x,x=b.y-M.y,w=p*p+x*x;0===w?(U=E(),s=E()):36e4>w&&(U=p/w,s=x/w);var c=b.r*M.r/400;U*=c,s*=c,b.dx+=U,b.dy+=s,M.dx-=U,M.dy-=s}},moveNode:function(){var N=this,e=N._limitBounds,b=N._maxMotion,O=0,v=N._damper;N._nodes.each(function(D){if(!D.fix){var f=D.dx*v,P=D.dy*v;if(D.dx=f/2,D.dy=P/2,O=l(i(f*f+P*P),O),D.x+=l(-40,k(40,f)),D.y+=l(-40,k(40,P)),e){D.x<e.x&&(D.x=e.x,N.adjust(1,0)),D.y<e.y&&(D.y=e.y,N.adjust(0,1));var W=D.s;D.x+W.width>e.x+e.width&&(D.x=e.x+e.width-W.width,N.adjust(-1,0)),D.y+W.height>e.y+e.height&&(D.y=e.y+e.height-W.height,N.adjust(0,-1))}}}),N._maxMotion=O,N._motionRatio=O>0?b/O-1:0,N.damp()},adjust:function(t,q){var K=this._limitBounds;this._nodes.each(function(k){t>0?(!K||k.x+k.s.width+t<K.x+K.width)&&(k.x+=t):(!K||k.x+t>K.x)&&(k.x+=t),q>0?(!K||k.y+k.s.height+q<K.y+K.height)&&(k.y+=q):(!K||k.y+q>K.y)&&(k.y+=q)})}});var f=y.layout.Force3dLayout=function(O){this.init(O)};y.Default.def(O+"Force3dLayout",I,{ms_force:1,getNodeSize3d:function(f){return f.s3()},addNode:function(l){var B=this,D=B._nodeMap[l._id];if(D)return D;D={v:l,p:l.p3(),d:[0,0,0],fix:!B.isLayoutable(l),s:B.getNodeSize3d(l)};var k=D.s,h=y.Default.getDistance(k)*B._nodeRepulsion;return D.r=1>h?100:h,B._nodeMap[l._id]=D,B._nodes.add(D),D},addEdge:function(I){if(I._40I&&I._41I){var c=this,p=c.addNode(I._40I),m=c.addNode(I._41I),w={s:p,t:m};m=m.s,p=p.s,w.length=i(Z(m[0]+p[0])+Z(m[1]+p[1])+Z(m[2]+p[2]))*c._edgeRepulsion,w.length<=0&&(w.length=100),c._edges.add(w)}},relaxEdge:function(r){var o=r.t.p,w=r.s.p,Y=r.t.d,A=r.s.d,U=o[0]-w[0],T=o[1]-w[1],v=o[2]-w[2],C=i(U*U+T*T+v*v),g=100*r.length,k=.25*U/g*C,D=.25*T/g*C,p=.25*v/g*C;Y[0]-=k,Y[1]-=D,Y[2]-=p,A[0]+=k,A[1]+=D,A[2]+=p},relaxNode:function(C,s){if(C!==s){var n=C.p,H=s.p,f=0,p=0,X=0,a=n[0]-H[0],q=n[1]-H[1],O=n[2]-H[2],l=a*a+q*q+O*O;0===l?(f=E(),p=E(),X=E()):216e6>l&&(f=a/l,p=q/l,X=O/l);var D=C.r*s.r/400,V=C.d,J=s.d;f*=D,p*=D,X*=D,V[0]+=f,V[1]+=p,V[2]+=X,J[0]-=f,J[1]-=p,J[2]-=X}},moveNode:function(){var J=this,u=J._maxMotion,M=0,y=J._damper;J._nodes.each(function(n){if(!n.fix){var O=n.p,Q=n.d,v=Q[0]*y,F=Q[1]*y,m=Q[2]*y;Q[0]=v/2,Q[1]=F/2,Q[2]=m/2,M=l(i(v*v+F*F+m*m),M),O[0]+=l(-40,k(40,v)),O[1]+=l(-40,k(40,F)),O[2]+=l(-40,k(40,m))}}),J._maxMotion=M,J._motionRatio=M>0?u/M-1:0,J.damp()}})}(this,Object);