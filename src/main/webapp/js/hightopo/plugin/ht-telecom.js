!function(Z,w){"use strict";var t=ht.AlarmSeverity=function(q,o,J,p,z){this.value=q,this.name=o,this.nickName=J,this.color=p,this.displayName=z};ht.Default.def("ht.AlarmSeverity",w,{toString:function(){return this.displayName||this.name}}),function(){t.severities=new ht.List,t._vm={},t._nm={},t._cp=function(X,M){if(X&&M){var i=X.value-M.value;return i>0?1:0>i?-1:0}return X&&!M?1:!X&&M?-1:0},t.each=function(J,k){t.severities.each(J,k)},t.getSortFunction=function(){return t._cp},t.setSortFunction=function(d){t._cp=d,t.severities.sort(d)},t.add=function(C,x,U,Q,l){var c=new t(C,x,U,Q,l);return t._vm[C]=c,t._nm[x]=c,t.severities.add(c),t.severities.sort(t._cp),c},t.remove=function(f){var L=t._nm[f];return L&&(delete t._nm[f],delete t._vm[L.value],t.severities.remove(L)),L},t.CRITICAL=t.add(500,"Critical","C","#FF0000"),t.MAJOR=t.add(400,"Major","M","#FFA000"),t.MINOR=t.add(300,"Minor","m","#FFFF00"),t.WARNING=t.add(200,"Warning","W","#00FFFF"),t.INDETERMINATE=t.add(100,"Indeterminate","N","#C800FF"),t.CLEARED=t.add(0,"Cleared","R","#00FF00"),t.isClearedAlarmSeverity=function(l){return l?0===l.value:!1},t.getByName=function(q){return t._nm[q]},t.getByValue=function(A){return t._vm[A]},t.clear=function(){t.severities.clear(),t._vm={},t._nm={}},t.compare=function(P,R){return t._cp(P,R)}}();var k=ht.AlarmState=function(i){this._d=i,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",w,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var e=null;for(var d in this._am)d=t.getByName(d),t.isClearedAlarmSeverity(d)||0!==this.getAcknowledgedAlarmCount(d)&&(e=e?t.compare(e,d)>0?e:d:d);this._haa=e},_c2:function(){var z=null;for(var l in this._nm)l=t.getByName(l),t.isClearedAlarmSeverity(l)||0!==this.getNewAlarmCount(l)&&(z=z?t.compare(z,l)>0?z:l:l);this._hna=z},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var F in this._nm)if(F=t.getByName(F),!t.isClearedAlarmSeverity(F)&&0!==this.getNewAlarmCount(F)&&t.compare(this._hna,F)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var u=this._haa,x=this._hna,n=this._ps;this._hoa=u,t.compare(x,this._hoa)>0&&(this._hoa=x),t.compare(n,this._hoa)>0&&(this._hoa=n)},_c5:function(){var M=this._haa,R=this._hna;this._hta=M,t.compare(R,this._hta)>0&&(this._hta=R)},increaseAcknowledgedAlarm:function(i,l){if(0!==l){l=l||1;var o=this._am[i.name]||0;o+=l,this._am[i.name]=o,this._f()}},increaseNewAlarm:function(q,k){if(0!==k){k=k||1;var d=this._nm[q.name]||0;d+=k,this._nm[q.name]=d,this._f()}},decreaseAcknowledgedAlarm:function(x,A){if(0!==A){A||(A=1);var a=this._am[x.name]||0;if(a-=A,0>a)throw"Alarm count can not be negative";this._am[x.name]=a,this._f()}},decreaseNewAlarm:function(x,W){if(0!==W){W||(W=1);var w=this._nm[x.name]||0;if(w-=W,0>w)throw"Alarm count can not be negative";this._nm[x.name]=w,this._f()}},acknowledgeAlarm:function(W){this.decreaseNewAlarm(W,1),this.increaseAcknowledgedAlarm(W,1)},acknowledgeAllAlarms:function(N){if(N){var f=this.getNewAlarmCount(N);this.decreaseNewAlarm(N,f),this.increaseAcknowledgedAlarm(N,f)}else for(var V in this._nm)this.acknowledgeAllAlarms(t.getByName(V))},_c6:function(){this._aac=0;for(var Z in this._am)Z=t.getByName(Z),this._aac+=this.getAcknowledgedAlarmCount(Z)},getAcknowledgedAlarmCount:function(x){return x?this._am[x.name]||0:this._aac},getAlarmCount:function(L){return this.getAcknowledgedAlarmCount(L)+this.getNewAlarmCount(L)},_c7:function(){this._nac=0;for(var T in this._nm)this._nac+=this.getNewAlarmCount(t.getByName(T))},getNewAlarmCount:function(I){return I?this._nm[I.name]||0:this._nac},setNewAlarmCount:function(t,w){this._nm[t.name]=w,this._f()},removeAllNewAlarms:function(G){G?delete this._nm[G]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(U,i){this._am[U.name]=i,this._f()},removeAllAcknowledgedAlarms:function(M){M?delete this._am[M.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(m){if(this._ep||(m=null),this._ps!==m){var W=this._ps;this._ps=m,this._f(),this._d.fp("propagateSeverity",W,m)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(G){var U=this._ep;this._ep=G,this._d.fp("enablePropagation",U,G)&&(G||this.setPropagateSeverity(null))}});var U=ht.AlarmStatePropagator=function(F){this._dataModel=F,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",w,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(j){this._enable!==j&&(this._enable=j,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(B){this.propagate(B)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(B){B.data&&this.propagate(B.data)},handleDataPropertyChange:function(K){if("alarmState"===K.property||"enablePropagation"===K.property)this.propagate(K.data);else if("parent"===K.property){var S=K.oldValue;S&&this.propagate(S),this.propagate(K.data)}},propagate:function(Y){Y&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(Y),this._isPropagating=!1)},propagateToTop:function(C){for(this.propagateToParent(null,C);C&&C.getParent();)this.propagateToParent(C,C.getParent()),C=C.getParent()},propagateToParent:function(h,F){var D=null;F.getChildren().each(function(e){var Z=e.getAlarmState().getHighestOverallAlarmSeverity();t.compare(Z,D)>0&&(D=Z)}),F.getAlarmState().setPropagateSeverity(D)}}),ht.AlarmStateStatistics=function(o){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(o)},ht.Default.def("ht.AlarmStateStatistics",w,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(U){var e=this._dataModel;e!==U&&(e&&(e.umd(this.handleDataPropertyChange,this),e.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=U,this.reset(),U.md(this.handleDataPropertyChange,this),U.mm(this.handleDataModelChange,this),this.fp("dataModel",e,U))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(k){"alarmState"===k.property&&(this.increase(k.data),this.fireAlarmStateChange())},handleDataModelChange:function(W){"add"===W.kind?(this.increase(W.data),this.fireAlarmStateChange()):"remove"===W.kind?(this.decrease(W.data),this.fireAlarmStateChange()):"clear"===W.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,t.each(function(E){var W=this.getSumInfo(E);this.sumAcked+=W.ackedCount,this.sumNew+=W.newCount,this.sumTotal+=W.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(r){if(!r)return this.sumNew;var i=this.getSumInfo(r);return i.newCount},getAcknowledgedAlarmCount:function(F){if(!F)return this.sumAcked;var Z=this.getSumInfo(F);return Z.ackedCount},getTotalAlarmCount:function(j){if(!j)return this.sumTotal;var C=this.getSumInfo(j);return C.totalCount},getSumInfo:function(h){var c=this.severtiyMap[h.name];return c||(c={},c.newCount=0,c.ackedCount=0,c.totalCount=0,this.severtiyMap[h.name]=c),c},decrease:function(e){var g=this.dataMap[e.getId()];g&&(delete this.dataMap[e.getId()],t.each(function(L){var P=g[L.name],D=this.getSumInfo(L);D.newCount=D.newCount-P.newCount,D.ackedCount=D.ackedCount-P.ackedCount,D.totalCount=D.totalCount-P.totalCount},this))},increase:function(G){if(this.decrease(G),!this._filterFunc||this._filterFunc(G)){var O={},A=G.getAlarmState();this.dataMap[G.getId()]=O,t.each(function(Q){var B={};B.newCount=A.getNewAlarmCount(Q),B.ackedCount=A.getAcknowledgedAlarmCount(Q),B.totalCount=A.getAlarmCount(Q),O[Q.name]=B;var n=this.getSumInfo(Q);n.newCount=n.newCount+B.newCount,n.ackedCount=n.ackedCount+B.ackedCount,n.totalCount=n.totalCount+B.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(v){var H=this._filterFunc;this._filterFunc=v,this.reset(),this.firePropertyChange("filterFunc",H,v)},getFilterFunc:function(){return this._filterFunc}});var T=ht.Data.prototype;T.getAlarmState=function(){return this._alarmState||(this._alarmState=new k(this))},T=ht.DataModel.prototype,T.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},T.setEnableAlarmStatePropagator=function(l){l!=this.isEnableAlarmStatePropagator()&&(l?(this._alarmStatePropagator=new U(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},T=ht.graph.GraphView.prototype,T.getNote2=function(b){var U=b.getAlarmState().getHighestNewAlarmSeverity();if(U){var j=b.getAlarmState().getNewAlarmCount(U)+U.nickName;return b.getAlarmState().hasLessSevereNewAlarms()&&(j+="+"),j}return b.s("note2")},T.getNote2Background=function(g){var W=g.getAlarmState().getHighestNewAlarmSeverity();return W?W.color:g.s("note2.background")},T.getBodyColor=function($){var p=$.getAlarmState().getHighestNativeAlarmSeverity();return p?p.color:$.s("body.color")},T.getBorderColor=function(r){var Z=r.getAlarmState().getPropagateSeverity();return Z?Z.color:r.s("border.color")},T=ht.widget.TreeView.prototype,T.getBorderColor=function(X){var t=X.getAlarmState().getPropagateSeverity();return t?t.color:X.s("border.color")},T.getIcon=function(s){return s.getIcon()?"__alarmIcon__":null},T=ht.widget.TreeTableView.prototype,T.getBorderColor=function(V){var M=V.getAlarmState().getPropagateSeverity();return M?M.color:V.s("border.color")},T.getIcon=function(A){return A.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(v){return v.getIcon()}},color:{func:function(e){var l=e.getAlarmState().getHighestNativeAlarmSeverity();return l?l.color:e.s("body.color")}},rect:[0,0,16,16]}]});var h=ht.Style;h["note2.expanded"]=!0,h["note2.color"]="#000"}(this,Object);