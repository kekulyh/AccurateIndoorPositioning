!function(D,g){"use strict";var t="ht",N=D[t],$=N.Default,L=$.def,o="add",y="remove",i=$.getInternal(),c="propertyChange";N.HistoryManager=function(C){this._histories=[],this.setDataModel(C)},L(N.HistoryManager,g,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var D=this;D.$4p++,1===D.$4p&&(D.$3p=[])},endInteraction:function(){var q=this,p=q._histories,f=q._historyIndex,d=q.$3p;q.$4p--,0===q.$4p&&(delete q.$3p,d.length&&(p=p.slice(0,f+1),p.push(d),p.length>q._maxHistoryCount&&(p=p.slice(p.length-q._maxHistoryCount)),q.setHistories(p),q.setHistoryIndex(p.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(A){var z=this,s=z._dataModel;s!==A&&(s&&(delete s._historyManager,s.umm(z.$5p,z),s.umd(z.$6p,z)),z._dataModel=A,A._historyManager=z,A.mm(z.$5p,z),A.md(z.$6p,z),z.fp("dataModel",s,A),z.clear())},setHistoryIndex:function(o,W){var z=this,R=z._historyIndex,n=z._histories.length;if(-1>o?o=-1:o>=n&&(o=n-1),R!==o){if(!W){var v=o-R;v>0?z.$2p(v):0>v&&z.$1p(-v)}z._historyIndex=o,z.fp("historyIndex",R,o)}},setMaxHistoryCount:function(_){var r=this,x=r._histories,l=r._maxHistoryCount;(!_||0>=_)&&(_=10),l!==_&&(r._maxHistoryCount=_,r.fp("maxHistoryCount",l,_),x.length>_&&r.clear())},$5p:function(H){if(!this.$7p&&!this.$8p){var t,F,V=this,A=V._histories,I=H.kind,k=H.property,W=V._historyIndex;if(I===o||I===y?F={type:H.kind,data:H.data}:k&&"children"!==k&&"attaches"!==k&&"shape"!==k&&(F={type:c,data:H.data,property:k,oldValue:H.oldValue,newValue:H.newValue}),F)if(V.$4p){t=V.$3p;var M=!1;if(F.type===c)for(var T=t.length-1;T>=0;T--){var w=t[T];if(w.type!==c)break;F.property===w.property&&w.property&&F.data===w.data&&(F.oldValue=w.oldValue,t[T]=F,M=!0)}M||t.push(F)}else t=[F],A=A.slice(0,W+1),A.push(t),A.length>V._maxHistoryCount&&(A=A.slice(A.length-V._maxHistoryCount)),V.setHistories(A),V.setHistoryIndex(A.length-1,!0)}},$6p:function(s){this.$5p(s)},undo:function(o){(!o||0>=o)&&(o=1),this.setHistoryIndex(this._historyIndex-o)},$1p:function(B){var j,z=this,N=z._dataModel,g=z._histories,w=z._historyIndex;for(z.$7p=1,$.setIsolating(!0);B>0;){if(w>=0&&w<g.length){j=g[w],w--;for(var d=j.length-1;d>=0;d--){var k=j[d],n=k.type,P=k.data,p=k.property,Q=k.oldValue;if(n===o)N.remove(P);else if(n===y)N.add(P);else{var A=null;0===p.indexOf("a:")?(A="attr",p=p.replace("a:","")):0===p.indexOf("s:")&&(A="style",p=p.replace("s:","")),i.setPropertyValue(P,A,p,Q)}}}B--}$.setIsolating(!1),delete z.$7p},redo:function(T){(!T||0>=T)&&(T=1),this.setHistoryIndex(this._historyIndex+T)},$2p:function(n){var m,A=this,d=A._dataModel,T=A._histories,r=A._historyIndex;for(A.$7p=1,$.setIsolating(!0);n>0;){if(r>=-1&&r<T.length-1){r++,m=T[r];for(var j=0;j<m.length;j++){var M=m[j],R=M.type,f=M.data,q=M.property,I=M.newValue;if(R===o)d.add(f);else if(R===y)d.remove(f);else{var Z=null;0===q.indexOf("a:")?(Z="attr",q=q.replace("a:","")):0===q.indexOf("s:")&&(Z="style",q=q.replace("s:","")),i.setPropertyValue(f,Z,q,I)}}}n--}$.setIsolating(!1),delete A.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}(this,Object);