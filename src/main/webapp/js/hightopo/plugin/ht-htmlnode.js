!function(V){"use strict";var r="ht",Q=V[r],v=function(){return document},g=function(){return v().body},b=function(Q,d,$){Q.style.setProperty(d,$,null)},j=function($){return v().createElement($)},e=function(){return j("div")},_=function(){var f=j("canvas");return f},H=function(j,I){b(j,"-webkit-transform",I),b(j,"-ms-transform",I),b(j,"transform",I)},s=function(Z,$){b(Z,"-webkit-transform-origin",$),b(Z,"-ms-transform-origin",$),b(Z,"transform-origin",$)},D=function(p,G){p.appendChild(G)},z=function(H,d){H.removeChild(d)},A=V.parseInt,x=Q.Default,U=x.getInternal(),o=Math.PI,t="white-space",C="visibility",w="left",Z="top",N="width",J="height",T="position",S="display",q="z-index",f="px",E="0 0",X="absolute",B="visible",h="hidden",i="none",m="block",P="nowrap",K="rgba(0, 0, 0, 0.005)";x.setImage("node_dragger","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAN9JREFUeNrsV9sNhDAMKyzQVdgARmGzrMJNUFZhAh6nfkVcG9PQgHSR8lEksJs6pnGuLCimSRzAa0yyBK9O4gy8GokU+O0kJOAwiQYg0LP1xNYDW3+0CfBYNb7VOuN4LAGpiOaYUhFDas9F2NPHDELNENJqaHgBgSQJ3ufakfQJqckERcOiK+Ae1FGWBNKGh9oX5WPpLpdNYfffijbsxTHh7VKP7388n1g1h7OKUoUuyGpJakQEuhwkZAKcDXVOdWcrOrL/feBVBHI/q8fcjE1nA9PpyHQ+NJ2Qi8A3AQYAOtS27fCoRY0AAAAASUVORK5CYII=");var Y=Q.graph.GraphView.prototype,R=Y._42;Y.adjustHtmlNodeIndex=!0,Y._42=function(n,m){if(R.call(this,n,m),this.adjustHtmlNodeIndex)for(var K=this.getDataModel()._datas._as,C=K.length,r=1,i=0;C>i;i++){var P=K[i];if(P instanceof c){var e=this.getDataUI(P);b(e.$2f,q,r+""),b(e.$3f,q,r+1+""),r+=2}}};var n=Q.HtmlNodeUI=function(M,d){var c=this;n.superClass.constructor.call(c,M,d);var Y=c.$2f=e(),r=c.$3f=_();b(Y,T,X),b(Y,C,h),b(Y,t,P),r.draggable=!1,b(r,T,X),b(r,S,i),s(r,E),Y.addEventListener("change",function(X){var B=X.target,I=B.bind||B.getAttribute("bind"),C=B.type&&"checkbox"===B.type?B.checked:B.value,A=d.getContext();I&&A&&(A[I]=C,c.$4f=JSON.stringify(A))}),["mousedown","touchstart","keydown","mousewheel","DOMMouseScroll"].forEach(function(e){Y.addEventListener(e,this.$9f.bind(this))},c)};x.def(n,U.ui().NodeUI,{_visible:!0,$11f:function(){var C=this,f=C.$3f,m=C._data,j=m.getDraggerImageWidth(),L=m.getDraggerImageHeight(),o=m.getDraggerImage(),V=U.initContext(f);V.beginPath(),U.setCanvas(f,j,L),U.translateAndScale(V,0,0,1),V.clearRect(0,0,j,L),x.drawImage(V,x.getImage(o),0,0,j,L),V.restore()},_80o:function(z){n.superClass._80o.call(this,z);var v=this,O=v._data,g=O._padding,P=2*g,r=v.$2f,t=v.$3f,$=v.gv,p=$.getZoom(),V=$.getTranslateX(),j=$.getTranslateY(),x=$.getView(),U=v._83o,d=O._width,Y=O._height,Q=U.position,_=U.rotation,y=(d-P)/O.$5f*p,M=(Y-P)/O.$6f*p,c=v._html,l=O._html,a=O.getHtmlType();if("html"===a){var k=O.getContext()||{},G=v.$4f,I=O.$10f,s=JSON.stringify(k);c&&G&&c===l&&G===s||(v.$4f=s,v._html=l,r.innerHTML=I?I(k):l)}else if(null!=a){var W=O.getHtml();"ht"===a&&(W=W.getView()),c&&c===W||(v._html=W,r.innerHTML="",D(r,W))}if(!r.parentNode){var F=$.$1f;if(!F){var u=e();b(u,T,X),b(u,q,"0"),F=$.$1f=u;var L=$._canvas.nextSibling;L?x.insertBefore(u,L):D(x,u)}D(F,r),D(F,t)}if(O._scalable){var R=O.$5f,E=O.$6f;H(r,"rotate("+180*(_/o)+"deg) scale("+y+","+M+")"),b(r,w,(Q.x-R/p/2)*p+V+f),b(r,Z,(Q.y-E/p/2)*p+j+f)}else{var lm=A(r.style.width),Ad=A(r.style.height),fi=A((d-P)*p),pm=A((Y-P)*p),Hd="100%",ki=r.children[0];b(ki,N,Hd),b(ki,J,Hd),(lm!==fi||Ad!==pm)&&(b(r,N,fi+f),b(r,J,pm+f),"ht"===a&&l.invalidate()),H(r,"rotate("+180*(_/o)+"deg)"),b(r,w,(Q.x-fi/p/2)*p+V+f),b(r,Z,(Q.y-pm/p/2)*p+j+f)}var Gh=v.dragRect;$.isMovable(O)&&$.isSelected(O)&&Gh?(z.save(),z.fillStyle=K,z.fillRect(Gh.x,Gh.y,Gh.width,Gh.height),z.restore(),b(t,w,Gh.x*p+V+f),b(t,Z,Gh.y*p+j+f),H(t,"scale("+p+","+p+")"),b(t,S,m),v.$11f()):b(t,S,i),b(r,C,this._visible?B:h)},dispose:function(){var j=this.gv.$1f;j.removeChild(this.$2f),j.removeChild(this.$3f)},_84o:function(Y){this._visible=Y,b(this.$2f,C,Y?B:h),b(this.$3f,S,Y?m:i)},_3O:function(){var j=this,w=j._data;n.superClass._3O.call(j);var $=w.getRect();j.dragRect={x:$.x+$.width+w._padding,y:$.y+10,width:w.getDraggerImageWidth(),height:w.getDraggerImageHeight()},j._68o(j.dragRect)},rectIntersects:function(F){var N=this._79o();return Q.Default.intersection(N,F)?!0:void 0},$9f:function(d){var u=this.gv,r=this._data;u.sm().contains(r)&&d.stopPropagation()}});var c=Q.HtmlNode=function(){c.superClass.constructor.call(this)};Q.Default.def(c,Q.Node,{ms_ac:["html","context","scalable","padding","draggerImage","draggerImageWidth","draggerImageHeight"],_padding:Q.Default.isTouchable?12:6,_image:null,_scalable:!0,_draggerImage:"node_dragger",_draggerImageWidth:20,_draggerImageHeight:20,setHtml:function(t){var j=this,D=j._html;j._html=t,"html"===j.getHtmlType()&&"Handlebars"in V&&(j.$10f=Handlebars.compile(t)),j.$13f(),j.fp("html",D,t)},setContext:function(l){var m=this,C=m._context;m._context=l,m.fp("context",C,l),m.$13f()},setScalable:function(F){var o=this,t=o._scalable;o._scalable=F,o.fp("scalable",t,F),o.$13f()},getHtmlType:function(){var i=this._html;return i?"string"==typeof i?"html":i.getView?"ht":"dom":null},$13f:function(){var f=this,k=f._html,d=f.$10f;if(k){var A=e(),$=!1,v=f.getHtmlType();if(b(A,T,X),b(A,t,P),b(A,C,h),"html"===v?(A.innerHTML=d?d(f.getContext()||{}):k,$=!0):"ht"===v?(D(A,k.getView()),$=!0):"dom"===v&&(D(A,k),$=!0),$){var s=2*f._padding;D(g(),A),f.$5f=A.scrollWidth,f.$6f=A.scrollHeight,f._width=f.$5f+s,f._height=f.$6f+s,f._originWidth=f._width,f._originHeight=f._height,z(g(),A)}}},getUIClass:function(){return Q.HtmlNodeUI}})}(this,Object);