!function(N){"use strict";var o="ht",r=N[o],f=r.Default,S=Math,t=S.PI,T=2*t,m=S.sin,Z=S.cos,M=S.atan2,D=S.sqrt,a=S.max,h=S.floor,g=(S.round,S.ceil),V=S.abs,W=r.Shape,x=r.Edge,y=r.List,k=r.Style,s=r.graph,Q=f.getInternal(),i=Q.ui(),E=null,c="__segmentLengths",j="__lineTotalLength",n="__linePoints",F="__distance0",q="flow.count",u="flow.step",e="flow.element.max",d="flow.element.count",l="flow.element.min",P="flow.element.space",X="flow.element.autorotate",v="flow.element.background",L="flow.element.shadow.max",$="flow.element.shadow.min",Y="flow.element.shadow.begincolor",B="flow.element.shadow.endcolor",K="flow.element.shadow.visible",w="flow.element.image",C="flow",_="prototype",R=function(g){return document.createElement(g)},J=function(J){for(var K=0,v=J.length-1,r=0;v>r;r++){var p=J[r],E=J[r+1],w=E.x-p.x,g=E.y-p.y,n=D(w*w+g*g);K+=n}return K},A=function($,K){for(var I=0,_=0,i=0,N=$.length-1,L=0;N>L;L++){var X=$[L],w=$[L+1],j=w.x-X.x,V=w.y-X.y;if(i=D(j*j+V*V),I+=i,I>K){I-=i,_=L;break}}var U=$[_],x=$[_+1],y=M(x.y-U.y,x.x-U.x),A=K-I,V=m(y)*A,j=Z(y)*A;return{x:U.x+j,y:U.y+V}},I=function(W,A,I,u){var c=Z(u),z=m(u),j=c*A-z*I,J=z*A+c*I;return W?{x:W.x+j,y:W.y+J}:{x:j,y:J}},U=function(S,M){S[c]=S[j]=S[n]=M[F]=E},O=function(l,P,$,d,S,Y){var v,I,n,h,a,M,r,A,R,K,u,i=[];if(V(d)>T&&(d=T),a=g(V(d)/(t/4)),v=d/a,I=-v,n=-$,a>0){M=l+Z($)*S,r=P+m(-$)*Y,i.push({x:M,y:r});for(var D=0;a>D;D++)n+=I,h=n-I/2,A=l+Z(n)*S,R=P+m(n)*Y,K=l+Z(h)*(S/Z(I/2)),u=P+m(h)*(Y/Z(I/2)),i.push({x:K,y:u}),i.push({x:A,y:R})}return i},H=function(U){var P,F,m=U._data;if(m instanceof W){if(P=m.getPoints(),F=m.getSegments(),(!F||0===F.size())&&P){F=new r.List([1]);for(var a=1;a<P.size();a++)F.add(2)}}else if(m instanceof x){var N=U._78o;if(N){var l=N.type,q=N.points,b=N.segments,H=N._4O;if(!l||q){var w=N._69o,R=w.x,g=w.y,Y=N._70o,B=Y.x,$=Y.y;if(l)b?(P=new y({x:R,y:g}),P.addAll(q),P.add({x:B,y:$}),F=new y(b._as)):(P=new y({x:R,y:g}),F=new y([1]),q.each(function(i){P.add(i),F.add(2)}),P.add({x:B,y:$}),F.add(2));else if(N.looped){P=new y(O(R,g,0,T,N.radius,N.radius)),F=new y([1]);for(var a=0;a<(P.size()-1)/2;a++)F.add(3)}else P=new y,N.center?(P.add({x:N.c1.x,y:N.c1.y}),P.add({x:R,y:g}),P.add({x:B,y:$}),P.add({x:N.c2.x,y:N.c2.y}),F=new y([1,2,2,2])):(P.add({x:R,y:g}),P.add({x:B,y:$}),F=new y([1,2]))}else if(H)if(P=new y(H.points._as),H.segments)F=new y(H.segments._as);else{F=new y([1]);for(var a=1;a<H.points.size();a++)F.add(2)}}}if(P&&F){for(var u=Q.toPointsArray(P._as,F._as,50),E=u.length,D=[],a=0;E>a;a++){var S=u[a];S.length>1&&D.push(u[a])}m.s("flow.reverse")&&(D.reverse(),D.forEach(function(s){s.reverse()}));for(var h=0,o=[],V=D.length,a=0;V>a;a++){var S=D[a],_=J(S);h+=_,o.push(_)}if(m[c]=o,m[j]=h,m[n]=D,m instanceof x){var s=f.unionPoint(D),d=s.x+s.width/2,A=s.y+s.height/2;m.$10e={x:d,y:A}}z(U,!0)}},z=function(L,P){var W=L._data,h=W[j],w=W.s(q),v=W.s(u),Z=0,x=W[c],U=W.s(e),Y=W.s(l),f=W.s(d),A=(U-Y)/(f-1),J=[];if(x){if(1===f)J.push(U);else if(2===f)J.push(U),J.push(Y);else{if(!(f>2))return;J.push(U);for(var p=f-2;p>0;p--)J.push(Y+A*p);J.push(Y)}var g=0,k=0;J.forEach(function(K){f-1>g&&(k+=W.getFlowElementSpace(K)),g++}),k+=(U+Y)/2,Z=(h-w*k+k)/w;var T=L[F];for(null==T&&(T=0),P||(T+=v);T>h+k;){var B=L._overCount;B?B++:B=1,B>=w&&(B=null),L._overCount=B,W.s("flow.autoreverse")?B?T-=Z+k:(T=0,W.s("flow.reverse",!W.s("flow.reverse"))):T-=Z+k}L[F]=T}},p=function(g){var N=g.data,k=this.dm();if(N&&"add"===g.kind){var y=k.$3e;y&&N.s(C)&&y.indexOf(N)<0&&y.push(N)}"clear"===g.kind&&(k.$3e=[])},b=function(T){var x=T.property,i=T.data,u=T.newValue,I=this.dm().$3e;if(I&&"s:flow"===x)if(u)I.indexOf(i)<0&&I.push(i);else for(var l=I.length,U=0;l>U;U++)if(I[U]===i){I.splice(U,1);break}},G=function($,q){for(var M=0,r=q.length,E=0;r>E;E++){var G=q[E];if(M+=G,M>$)return E}return E},Hj=function(N){var y=this,Y=y._data,J=Y[j],m=Y[c],R=Y[n],w=Y.s(q),P=0,V=y[F],t=Y.s(e),a=Y.s(l),s=Y.s(d),g=Y.s($),p=Y.s(L),b=Y.s(X),x=(p-g)/(s-1),O=(t-a)/(s-1),i=Y.getRotation?Y.getRotation():0,Q=Y.getPosition?Y.p():Y.$10e,W=[],B=[];if(V!=E){if(1===s)W.push(t);else if(2===s)W.push(t),W.push(a);else{if(!(s>2))return;W.push(t);for(var h=s-2;h>0;h--)W.push(a+O*h);W.push(a)}if(1===s)B.push(p);else if(2===s)B.push(p),B.push(g);else{if(!(s>2))return;B.push(p);for(var h=s-2;h>0;h--)B.push(g+x*h);B.push(g)}var _=0,U=0;W.forEach(function(m){s-1>_&&(U+=Y.getFlowElementSpace(m)),_++}),U+=(t+a)/2,P=(J-w*U+U)/w,N.save();for(var h=0;w>h;h++){var Z=V,S=0,r=y._overCount,o=0;Y.s("flow.autoreverse")&&r&&r>w-(h+1)||(Z-=h*(P+U),_=0,W.forEach(function(C){var s=Z-S;if(s>=0&&J>s){var z=!0,E=G(s,m);o=0;for(var L=0;E>L;L++)o+=m[L];if(s-=o,z){var j=A(R[E],s),T=i;if(b){for(var e=R[E],K=0,w=0,U=0;U<e.length-1;U++){var g=e[U],r=e[U+1],f=r.x-g.x,p=r.y-g.y,q=D(f*f+p*p);if(K+=q,K>s){w=U;break}}var x=e[w];T+=M(j.y-x.y,j.x-x.x)}i&&(j=I(Q,j.x-Q.x,j.y-Q.y,i)),y.$5e(N,j,C,B[_],T)}}S+=Y.getFlowElementSpace(W[_]),_++}))}N.restore()}},Vb=s.GraphView[_],Uo=r.Data[_],Sb=i.DataUI[_],Go=i.ShapeUI[_],Qd=i.EdgeUI[_],Qo=r.DataModel[_],jq=Go._80o,Gq=Qd._80o,Wb=Qo.prepareRemove,kj=Qd._79o,ij=Go._79o,bl=Vb.setDataModel,Eo=function(){var F=this,z=F._data,w=z.s(e),t=!1,i=E;if(F._6I||(t=!0),i=z instanceof x?kj.call(F):ij.call(F),z.s(C)&&t){var b=z.s(L),V=z.s(K);V&&b>w&&(w=b),w>0&&f.grow(i,g(w/2)),H(F)}return!z.s(C)&&t&&U(z,F),i};Uo.getFlowElementSpace=function(){return this.s(P)},Go._79o=Eo,Qd._79o=Eo,k[e]==E&&(k[e]=7),k[l]==E&&(k[l]=0),k[q]==E&&(k[q]=1),k[u]==E&&(k[u]=3),k[d]==E&&(k[d]=10),k[P]==E&&(k[P]=3.5),k[X]==E&&(k[X]=!1),k[v]==E&&(k[v]="rgba(255, 255, 114, 0.4)"),k[Y]==E&&(k[Y]="rgba(255, 255, 0, 0.3)"),k[B]==E&&(k[B]="rgba(255, 255, 0, 0)"),k[K]==E&&(k[K]=1),k[L]==E&&(k[L]=22),k[$]==E&&(k[$]=4),Qo.prepareRemove=function(V){Wb.call(this,V);var B=V._dataModel,H=B.$3e;if(H)for(var n=H.length,q=0;n>q;q++)if(H[q]===V){H.splice(q,1);break}},Vb.setDataModel=function(U){var N=this,Q=N._dataModel;if(Q!==U){Q&&(Q.umm(p,N),Q.umd(b,N),Q.$3e=[]),U.mm(p,N),U.md(b,N);var v=U.$3e=[];U.each(function(K){K.s(C)&&v.indexOf(K)<0&&v.push(K)}),bl.call(N,U)}},Vb.setFlowInterval=function(Y){var C=this,L=C.$11e;C.$11e=Y,C.fp("flowInterval",L,Y),C.$7e!=E&&(clearInterval(C.$7e),delete C.$7e,C.enableFlow(Y))},Vb.getFlowInterval=function(){return this.$11e},Vb.$9e=function(){var t,K,C,Y=this,I=Y.tx(),w=Y.ty(),l=Y.getZoom(),L=Y.getWidth(),r=Y.getHeight(),S={x:-I/l,y:-w/l,width:L/l,height:r/l},N=Y.dm().$3e,x=Y._56I,J=new y;if(N.forEach(function(X){x[X.getId()]&&(t=Y.getDataUI(X),t&&(C=t._79o(),C&&J.add(C)))}),0!==J.size()&&(J.each(function(P){f.intersectsRect(S,P)&&(K=f.unionRect(K,P))}),K&&(K&&(f.grow(K,a(1,1/l)),K.x=h(K.x*l)/l,K.y=h(K.y*l)/l,K.width=g(K.width*l)/l,K.height=g(K.height*l)/l,K=f.intersection(S,K)),K))){var O=Y._canvas.getContext("2d");O.save(),O.lineCap=f.lineCap,O.lineJoin=f.lineJoin,Q.translateAndScale(O,I,w,l),O.beginPath(),O.rect(K.x,K.y,K.width,K.height),O.clip(),O.clearRect(K.x,K.y,K.width,K.height),Y.$6e(O,K),O.restore()}},Vb.$6e=function(I,d){var G,T,S=this;S._93db(I),S.each(function(Q){S._56I[Q._id]&&(G=S.getDataUI(Q),G&&(T=G._79o(),(!d||f.intersectsRect(d,T))&&G._42(I)))}),S._92db(I)},Vb.enableFlow=function(w){var G=this,o=G.dm(),q=o.$3e;G.$7e==E&&(q.forEach(function(k){var Z=G.getDataUI(k);H(Z)}),G.$7e=setInterval(function(){o.$3e.forEach(function(r){z(G.getDataUI(r))}),G.$9e()},w||G.$11e||50))},Vb.disableFlow=function(){var t=this;clearInterval(t.$7e),delete t.$7e;var s=t.dm().$3e;s&&t.$9e()},Sb.$5e=function(i,d,x,G,$){var k=this,m=k._data,l=k.gv,s=m.s(v),P=m.s(Y),y=m.s(B),a=m.s(K),c=l.$8e,z=m.s(w);if(c==E&&(c=l.$8e={}),i.beginPath(),z!=E){var L=f.getImage(z),e=x/2;i.translate(d.x,d.y),i.rotate($),i.translate(-d.x,-d.y),f.drawImage(i,L,d.x-e,d.y-e,x,x,m),i.translate(d.x,d.y),i.rotate(-$),i.translate(-d.x,-d.y)}else i.fillStyle=s,i.arc(d.x,d.y,x/2,0,T,!0),i.fill();if(a){var F=22,u=F+"_"+P+"_"+y,Z=c[u];if(Z==E){var H=R("canvas");Q.setCanvas(H,F,F);var X=H.getContext("2d"),r=F/2,U=r,n=r;Q.translateAndScale(X,0,0,1),X.beginPath();var N=X.createRadialGradient(U,n,0,U,U,r);N.addColorStop(0,P),N.addColorStop(1,y),X.fillStyle=N,X.arc(U,n,r,0,T,!0),X.fill(),Z=c[u]=H}var e=G/2;f.drawImage(i,Z,d.x-e,d.y-e,G,G,m)}},Qd._80o=function(S){Gq.call(this,S);var K=this,f=K._data,F=K.gv;f.s(C)&&F.$7e!=E&&Hj.call(K,S)},Go._80o=function(D){jq.call(this,D);var M=this,k=M._data,U=M.gv;k.s(C)&&U.$7e!=E&&Hj.call(M,D)}}(this,Object);